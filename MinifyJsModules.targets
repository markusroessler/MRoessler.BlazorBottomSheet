<!-- implementation template: https://github.com/dotnet/sdk/blob/e90c4413024970eca97d05122243737aa207af11/src/StaticWebAssetsSdk/Targets/Microsoft.NET.Sdk.StaticWebAssets.JSModules.targets#L428 -->
<Project>
  <PropertyGroup>
    <GenerateComputedBuildStaticWebAssetsDependsOn>$(GenerateComputedBuildStaticWebAssetsDependsOn);MinifyJsModules</GenerateComputedBuildStaticWebAssetsDependsOn>
  </PropertyGroup>

  <Target Name="MinifyJsModules">
    <ItemGroup>
      <_WebAssetMinifyInput Include="**/*.razor.js" Exclude="**/bin/**;**/obj/**" />
    </ItemGroup>
    <PropertyGroup>
      <_MinifyOutputDir>$(IntermediateOutputPath)bundled</_MinifyOutputDir>
    </PropertyGroup>
    <!-- <Message Importance="high" Text="_WebAssetMinifyInput: %(_WebAssetMinifyInput.Identity)" /> -->

    <Exec Command="npx esbuild @(_WebAssetMinifyInput, ' ') --minify --sourcemap --out-extension:.js=.min.js --outbase=. --outdir=&quot;$(_MinifyOutputDir)&quot;" />
    <ItemGroup>
      <_WebAssetMinifyOutput Include="$(_MinifyOutputDir)\**" />
    </ItemGroup>
    <!-- <Message Importance="high" Text="_WebAssetMinifyOutput: %(_WebAssetMinifyOutput.Identity)" /> -->

    <DefineStaticWebAssets CandidateAssets="@(_WebAssetMinifyOutput)"
        SourceId="$(PackageId)"
        SourceType="Computed"
        ContentRoot="$(_MinifyOutputDir)"
        BasePath="_content/$(PackageId)"
        AssetKind="All"
        AssetMode="All"
        AssetRole="Primary"
        AssetMergeSource="$(StaticWebAssetMergeTarget)">
      <Output TaskParameter="Assets" ItemName="_MyBundleStaticWebAsset" />
    </DefineStaticWebAssets>

    <DefineStaticWebAssetEndpoints CandidateAssets="@(_MyBundleStaticWebAsset)"
        ExistingEndpoints="@(StaticWebAssetEndpoint)"
        ContentTypeMappings="@(StaticWebAssetContentTypeMapping)">
      <Output TaskParameter="Endpoints" ItemName="_MyBundleStaticWebAssetEndpoint" />
    </DefineStaticWebAssetEndpoints>

    <ItemGroup>
      <StaticWebAsset Include="@(_MyBundleStaticWebAsset)" />
      <StaticWebAssetEndpoint Include="@(_MyBundleStaticWebAssetEndpoint)" />
    </ItemGroup>
  </Target>
</Project>